classdef ColorUtils
%# COLORUTILS - This class defines a series of functions and variables which 
%#              are useful for working with color data structures defined in
%#              the CSToolBox.
%#
%
%Author: Victor Medina Heierle
%Last update: 23-Jan-2017
%
%    
    properties (Constant)
        % Color Space IDs
        COLOR_SPACE_XYZ = 1;
        COLOR_SPACE_xyY = 2;
        COLOR_SPACE_LAB = 3;
        COLOR_SPACE_LUV = 4;
        COLOR_SPACE_RGB = 5;
        COLOR_SPACE_sRGB = 6;
        COLOR_SPACE_YIQ = 7;
        COLOR_SPACE_YUV = 8;
        COLOR_SPACE_YCbCr = 9;
        COLOR_SPACE_HSV = 10;
        COLOR_SPACE_HSL = 11;
        COLOR_SPACE_CMYK = 12;
        COLOR_SPACE_LMS = 13;
        
        spacenames_short = {'XYZ','xyY','LAB','LUV','RGB','sRGB','YIQ','YUV','YCbCr','HSV','HSL','CMYK','LMS'};
        spacenames_long = {'CIE 1931 XYZ','CIE xyY','CIELAB - CIE 1976 (L*,a*,b*)','CIELUV - CIE 1976 (L*,u*,v*)','CIE 1931 RGB','sRGB','YIQ','YUV','YCbCr','HSV','HSL','CMYK','LMS'};
        
        % Types of Color Surfaces
        COLOR_SURFACE_REFLECTIVE = 0;
        COLOR_SURFACE_TRANSMISSIVE = 1;
        COLOR_SURFACE_EMISSIVE = 2;
        COLOR_NON_SPECTRAL = 3;
        COLOR_SPECTRAL = 4;
        
        % Illuminant IDs
        ILLUM_D65 = 101;
        ILLUM_D55 = 102;
        ILLUM_A = 103;
        ILLUM_F7 = 104;
        
        % Chromatic Adaptation Transforms (CATs)
        CAT_BRADFORD = [[0.895100 0.266400 -0.161400]; [-0.750200 1.713500 0.036700]; [0.038900 -0.068500 1.029600]];
        CAT_VONKRIES = [[0.400240 0.707600 -0.080810]; [-0.226300 1.165320 0.045700]; [0 0 0.918220]];
        CAT_RLAB_E = [[0.38971 0.68898 -0.07868]; [-0.22981 1.18340 0.04641]; [0.00000 0.00000 1.00000]];        
        CAT_CAT97s = [[0.8562 0.3372 -0.1934]; [-0.8360 1.8327 0.0033]; [0.0357 -0.0469 1.0112]];
        CAT_CAT02 = [[0.7328 0.4296 -0.1624]; [-0.7036 1.6975 0.0061]; [0.0030 0.0136 0.9834]];
        
        % Matrix CAT_PITT45 is calculated from the fundamental primaries obtained by Pitt (Pitt, F.H.G. (1945). "The nature of normal trichromatic and dichromatic vision". Proc. Roy. Soc. B 132:101-117.)
        CAT_PITT45 = [[0.071 0.945 -0.016]; [-0.461 1.362 0.101]; [0 0 1]];
        
        CIE_1931_XYZ_CMF_1nm = [[360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 718 719 720 721 722 723 724 725 726 727 728 729 730 731 732 733 734 735 736 737 738 739 740 741 742 743 744 745 746 747 748 749 750 751 752 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767 768 769 770 771 772 773 774 775 776 777 778 779 780 781 782 783 784 785 786 787 788 789 790 791 792 793 794 795 796 797 798 799 800 801 802 803 804 805 806 807 808 809 810 811 812 813 814 815 816 817 818 819 820 821 822 823 824 825 826 827 828 829 830];...
                                [0.000129900 0.000145847 0.000163802 0.000184004 0.000206690 0.000232100 0.000260728 0.000293075 0.000329388 0.000369914 0.000414900 0.000464159 0.000518986 0.000581854 0.000655235 0.000741600 0.000845030 0.000964527 0.001094949 0.001231154 0.001368000 0.001502050 0.001642328 0.001802382 0.001995757 0.002236000 0.002535385 0.002892603 0.003300829 0.003753236 0.004243000 0.004762389 0.005330048 0.005978712 0.006741117 0.007650000 0.008751373 0.010028880 0.011421700 0.012869010 0.014310000 0.015704430 0.017147440 0.018781220 0.020748010 0.023190000 0.026207360 0.029782480 0.033880920 0.038468240 0.043510000 0.048995600 0.055022600 0.061718800 0.069212000 0.077630000 0.086958110 0.097176720 0.108406300 0.120767200 0.134380000 0.149358200 0.165395700 0.181983100 0.198611000 0.214770000 0.230186800 0.244879700 0.258777300 0.271807900 0.283900000 0.294943800 0.304896500 0.313787300 0.321645400 0.328500000 0.334351300 0.339210100 0.343121300 0.346129600 0.348280000 0.349599900 0.350147400 0.350013000 0.349287000 0.348060000 0.346373300 0.344262400 0.341808800 0.339094100 0.336200000 0.333197700 0.330041100 0.326635700 0.322886800 0.318700000 0.314025100 0.308884000 0.303290400 0.297257900 0.290800000 0.283970100 0.276721400 0.268917800 0.260422700 0.251100000 0.240847500 0.229851200 0.218407200 0.206811500 0.195360000 0.184213600 0.173327300 0.162688100 0.152283300 0.142100000 0.132178600 0.122569600 0.113275200 0.104297900 0.095640000 0.087299550 0.079308040 0.071717760 0.064580990 0.057950010 0.051862110 0.046281520 0.041150880 0.036412830 0.032010000 0.027917200 0.024144400 0.020687000 0.017540400 0.014700000 0.012161790 0.009919960 0.007967240 0.006296346 0.004900000 0.003777173 0.002945320 0.002424880 0.002236293 0.002400000 0.002925520 0.003836560 0.005174840 0.006982080 0.009300000 0.012149490 0.015535880 0.019477520 0.023992770 0.029100000 0.034814850 0.041120160 0.047985040 0.055378610 0.063270000 0.071635010 0.080462240 0.089739960 0.099456450 0.109600000 0.120167400 0.131114500 0.142367900 0.153854200 0.165500000 0.177257100 0.189140000 0.201169400 0.213365800 0.225749900 0.238320900 0.251066800 0.263992200 0.277101700 0.290400000 0.303891200 0.317572600 0.331438400 0.345482800 0.359700000 0.374083900 0.388639600 0.403378400 0.418311500 0.433449900 0.448795300 0.464336000 0.480064000 0.495971300 0.512050100 0.528295900 0.544691600 0.561209400 0.577821500 0.594500000 0.611220900 0.627975800 0.644760200 0.661569700 0.678400000 0.695239200 0.712058600 0.728828400 0.745518800 0.762100000 0.778543200 0.794825600 0.810926400 0.826824800 0.842500000 0.857932500 0.873081600 0.887894400 0.902318100 0.916300000 0.929799500 0.942798400 0.955277600 0.967217900 0.978600000 0.989385600 0.999548800 1.009089200 1.018006400 1.026300000 1.033982700 1.040986000 1.047188000 1.052466700 1.056700000 1.059794400 1.061799200 1.062806800 1.062909600 1.062200000 1.060735200 1.058443600 1.055224400 1.050976800 1.045600000 1.039036900 1.031360800 1.022666200 1.013047700 1.002600000 0.991367500 0.979331400 0.966491600 0.952847900 0.938400000 0.923194000 0.907244000 0.890502000 0.872920000 0.854449900 0.835084000 0.814946000 0.794186000 0.772954000 0.751400000 0.729583600 0.707588800 0.685602200 0.663810400 0.642400000 0.621514900 0.601113800 0.581105200 0.561397700 0.541900000 0.522599500 0.503546400 0.484743600 0.466193900 0.447900000 0.429861300 0.412098000 0.394644000 0.377533300 0.360800000 0.344456300 0.328516800 0.313019200 0.298001100 0.283500000 0.269544800 0.256118400 0.243189600 0.230727200 0.218700000 0.207097100 0.195923200 0.185170800 0.174832300 0.164900000 0.155366700 0.146230000 0.137490000 0.129146700 0.121200000 0.113639700 0.106465000 0.099690440 0.093330610 0.087400000 0.081900960 0.076804280 0.072077120 0.067686640 0.063600000 0.059806850 0.056282160 0.052971040 0.049818610 0.046770000 0.043784050 0.040875360 0.038072640 0.035404610 0.032900000 0.030564190 0.028380560 0.026344840 0.024452750 0.022700000 0.021084290 0.019599880 0.018237320 0.016987170 0.015840000 0.014790640 0.013831320 0.012948680 0.012129200 0.011359160 0.010629350 0.009938846 0.009288422 0.008678854 0.008110916 0.007582388 0.007088746 0.006627313 0.006195408 0.005790346 0.005409826 0.005052583 0.004717512 0.004403507 0.004109457 0.003833913 0.003575748 0.003334342 0.003109075 0.002899327 0.002704348 0.002523020 0.002354168 0.002196616 0.002049190 0.001910960 0.001781438 0.001660110 0.001546459 0.001439971 0.001340042 0.001246275 0.001158471 0.001076430 0.000999949 0.000928736 0.000862433 0.000800750 0.000743396 0.000690079 0.000640516 0.000594502 0.000551865 0.000512429 0.000476021 0.000442454 0.000411512 0.000382981 0.000356649 0.000332301 0.000309759 0.000288887 0.000269539 0.000251568 0.000234826 0.000219171 0.000204526 0.000190841 0.000178065 0.000166151 0.000155024 0.000144622 0.000134910 0.000125852 0.000117413 0.000109552 0.000102225 0.000095394 0.000089024 0.000083075 0.000077513 0.000072313 0.000067458 0.000062928 0.000058707 0.000054770 0.000051099 0.000047677 0.000044486 0.000041510 0.000038733 0.000036142 0.000033724 0.000031465 0.000029353 0.000027376 0.000025524 0.000023794 0.000022179 0.000020674 0.000019272 0.000017966 0.000016750 0.000015616 0.000014560 0.000013574 0.000012654 0.000011797 0.000010998 0.000010254 0.000009560 0.000008912 0.000008308 0.000007746 0.000007221 0.000006732 0.000006276 0.000005851 0.000005455 0.000005086 0.000004741 0.000004420 0.000004121 0.000003842 0.000003582 0.000003339 0.000003113 0.000002902 0.000002706 0.000002523 0.000002352 0.000002192 0.000002044 0.000001905 0.000001777 0.000001656 0.000001544 0.000001439 0.000001342 0.000001251];...
                                [0.000003917 0.000004394 0.000004930 0.000005532 0.000006208 0.000006965 0.000007813 0.000008767 0.000009840 0.000011043 0.000012390 0.000013886 0.000015557 0.000017443 0.000019584 0.000022020 0.000024840 0.000028041 0.000031531 0.000035215 0.000039000 0.000042826 0.000046915 0.000051590 0.000057176 0.000064000 0.000072344 0.000082212 0.000093508 0.000106136 0.000120000 0.000134984 0.000151492 0.000170208 0.000191816 0.000217000 0.000246907 0.000281240 0.000318520 0.000357267 0.000396000 0.000433715 0.000473024 0.000517876 0.000572219 0.000640000 0.000724560 0.000825500 0.000941160 0.001069880 0.001210000 0.001362091 0.001530752 0.001720368 0.001935323 0.002180000 0.002454800 0.002764000 0.003117800 0.003526400 0.004000000 0.004546240 0.005159320 0.005829280 0.006546160 0.007300000 0.008086507 0.008908720 0.009767680 0.010664430 0.011600000 0.012573170 0.013582720 0.014629680 0.015715090 0.016840000 0.018007360 0.019214480 0.020453920 0.021718240 0.023000000 0.024294610 0.025610240 0.026958570 0.028351250 0.029800000 0.031310830 0.032883680 0.034521120 0.036225710 0.038000000 0.039846670 0.041768000 0.043766000 0.045842670 0.048000000 0.050243680 0.052573040 0.054980560 0.057458720 0.060000000 0.062601970 0.065277520 0.068042080 0.070911090 0.073900000 0.077016000 0.080266400 0.083666800 0.087232800 0.090980000 0.094917550 0.099045840 0.103367400 0.107884600 0.112600000 0.117532000 0.122674400 0.127992800 0.133452800 0.139020000 0.144676400 0.150469300 0.156461900 0.162717700 0.169300000 0.176243100 0.183558100 0.191273500 0.199418000 0.208020000 0.217119900 0.226734500 0.236857100 0.247481200 0.258600000 0.270184900 0.282293900 0.295050500 0.308578000 0.323000000 0.338402100 0.354685800 0.371698600 0.389287500 0.407300000 0.425629900 0.444309600 0.463394400 0.482939500 0.503000000 0.523569300 0.544512000 0.565690000 0.586965300 0.608200000 0.629345600 0.650306800 0.670875200 0.690842400 0.710000000 0.728185200 0.745463600 0.761969400 0.777836800 0.793200000 0.808110400 0.822496200 0.836306800 0.849491600 0.862000000 0.873810800 0.884962400 0.895493600 0.905443200 0.914850100 0.923734800 0.932092400 0.939922600 0.947225200 0.954000000 0.960256100 0.966007400 0.971260600 0.976022500 0.980300000 0.984092400 0.987418200 0.990312800 0.992811600 0.994950100 0.996710800 0.998098300 0.999112000 0.999748200 1.000000000 0.999856700 0.999304600 0.998325500 0.996898700 0.995000000 0.992600500 0.989742600 0.986444400 0.982724100 0.978600000 0.974083700 0.969171200 0.963856800 0.958134900 0.952000000 0.945450400 0.938499200 0.931162800 0.923457600 0.915400000 0.907006400 0.898277200 0.889204800 0.879781600 0.870000000 0.859861300 0.849392000 0.838622000 0.827581300 0.816300000 0.804794700 0.793082000 0.781192000 0.769154700 0.757000000 0.744754100 0.732422400 0.720003600 0.707496500 0.694900000 0.682219200 0.669471600 0.656674400 0.643844800 0.631000000 0.618155500 0.605314400 0.592475600 0.579637900 0.566800000 0.553961100 0.541137200 0.528352800 0.515632300 0.503000000 0.490468800 0.478030400 0.465677600 0.453403200 0.441200000 0.429080000 0.417036000 0.405032000 0.393032000 0.381000000 0.368918400 0.356827200 0.344776800 0.332817600 0.321000000 0.309338100 0.297850400 0.286593600 0.275624500 0.265000000 0.254763200 0.244889600 0.235334400 0.226052800 0.217000000 0.208161600 0.199548800 0.191155200 0.182974400 0.175000000 0.167223500 0.159646400 0.152277600 0.145125900 0.138200000 0.131500300 0.125024800 0.118779200 0.112769100 0.107000000 0.101476200 0.096188640 0.091122960 0.086264850 0.081600000 0.077120640 0.072825520 0.068710080 0.064769760 0.061000000 0.057396210 0.053955040 0.050673760 0.047549650 0.044580000 0.041758720 0.039084960 0.036563840 0.034200480 0.032000000 0.029962610 0.028076640 0.026329360 0.024708050 0.023200000 0.021800770 0.020501120 0.019281080 0.018120690 0.017000000 0.015903790 0.014837180 0.013810680 0.012834780 0.011920000 0.011068310 0.010273390 0.009533311 0.008846157 0.008210000 0.007623781 0.007085424 0.006591476 0.006138485 0.005723000 0.005343059 0.004995796 0.004676404 0.004380075 0.004102000 0.003838453 0.003589099 0.003354219 0.003134093 0.002929000 0.002738139 0.002559876 0.002393244 0.002237275 0.002091000 0.001953587 0.001824580 0.001703580 0.001590187 0.001484000 0.001384496 0.001291268 0.001204092 0.001122744 0.001047000 0.000976590 0.000911109 0.000850133 0.000793238 0.000740000 0.000690083 0.000643310 0.000599496 0.000558455 0.000520000 0.000483914 0.000450053 0.000418345 0.000388718 0.000361100 0.000335384 0.000311440 0.000289166 0.000268454 0.000249200 0.000231302 0.000214686 0.000199288 0.000185048 0.000171900 0.000159778 0.000148604 0.000138302 0.000128793 0.000120000 0.000111860 0.000104322 0.000097336 0.000090846 0.000084800 0.000079147 0.000073858 0.000068916 0.000064303 0.000060000 0.000055982 0.000052226 0.000048718 0.000045447 0.000042400 0.000039561 0.000036915 0.000034449 0.000032148 0.000030000 0.000027991 0.000026114 0.000024360 0.000022725 0.000021200 0.000019779 0.000018453 0.000017217 0.000016065 0.000014990 0.000013987 0.000013052 0.000012178 0.000011363 0.000010600 0.000009886 0.000009217 0.000008592 0.000008009 0.000007466 0.000006960 0.000006488 0.000006049 0.000005639 0.000005258 0.000004902 0.000004570 0.000004260 0.000003972 0.000003703 0.000003452 0.000003218 0.000003000 0.000002797 0.000002608 0.000002431 0.000002267 0.000002113 0.000001970 0.000001837 0.000001712 0.000001596 0.000001488 0.000001387 0.000001293 0.000001206 0.000001124 0.000001048 0.000000977 0.000000911 0.000000849 0.000000792 0.000000738 0.000000688 0.000000642 0.000000598 0.000000558 0.000000520 0.000000485 0.000000452];...
                                [0.000606100 0.000680879 0.000765146 0.000860012 0.000966593 0.001086000 0.001220586 0.001372729 0.001543579 0.001734286 0.001946000 0.002177777 0.002435809 0.002731953 0.003078064 0.003486000 0.003975227 0.004540880 0.005158320 0.005802907 0.006450001 0.007083216 0.007745488 0.008501152 0.009414544 0.010549990 0.011965800 0.013655870 0.015588050 0.017730150 0.020050010 0.022511360 0.025202880 0.028279720 0.031897040 0.036210000 0.041437710 0.047503720 0.054119880 0.060998030 0.067850010 0.074486320 0.081361560 0.089153640 0.098540480 0.110200000 0.124613300 0.141701700 0.161303500 0.183256800 0.207400000 0.233692100 0.262611400 0.294774600 0.330798500 0.371300000 0.416209100 0.465464200 0.519694800 0.579530300 0.645600000 0.718483800 0.796713300 0.877845900 0.959439000 1.039050100 1.115367300 1.188497100 1.258123300 1.323929600 1.385600000 1.442635200 1.494803500 1.542190300 1.584880700 1.622960000 1.656404800 1.685295900 1.709874500 1.730382100 1.747060000 1.760044600 1.769623300 1.776263700 1.780433400 1.782600000 1.782968200 1.781699800 1.779198200 1.775867100 1.772110000 1.768258900 1.764039000 1.758943800 1.752466300 1.744100000 1.733559500 1.720858100 1.705936900 1.688737200 1.669200000 1.647528700 1.623412700 1.596022300 1.564528000 1.528100000 1.486111400 1.439521500 1.389879900 1.338736200 1.287640000 1.237422300 1.187824300 1.138761100 1.090148000 1.041900000 0.994197600 0.947347300 0.901453100 0.856619300 0.812950100 0.770517300 0.729444800 0.689913600 0.652104900 0.616200000 0.582328600 0.550416200 0.520337600 0.491967300 0.465180000 0.439924600 0.416183600 0.393882200 0.372945900 0.353300000 0.334857800 0.317552100 0.301337500 0.286168600 0.272000000 0.258817100 0.246483800 0.234771800 0.223453300 0.212300000 0.201169200 0.190119600 0.179225400 0.168560800 0.158200000 0.148138300 0.138375800 0.128994200 0.120075100 0.111700000 0.103904800 0.096667480 0.089982720 0.083845310 0.078249990 0.073208990 0.068678160 0.064567840 0.060788350 0.057250010 0.053904350 0.050746640 0.047752760 0.044898590 0.042160000 0.039507280 0.036935640 0.034458360 0.032088720 0.029840000 0.027711810 0.025694440 0.023787160 0.021989250 0.020300000 0.018718050 0.017240360 0.015863640 0.014584610 0.013400000 0.012307230 0.011301880 0.010377920 0.009529306 0.008749999 0.008035200 0.007381600 0.006785400 0.006242800 0.005749999 0.005303600 0.004899800 0.004534200 0.004202400 0.003900000 0.003623200 0.003370600 0.003141400 0.002934800 0.002749999 0.002585200 0.002438600 0.002309400 0.002196800 0.002100000 0.002017733 0.001948200 0.001889800 0.001840933 0.001800000 0.001766267 0.001737800 0.001711200 0.001683067 0.001650001 0.001610133 0.001564400 0.001513600 0.001458533 0.001400000 0.001336667 0.001270000 0.001205000 0.001146667 0.001100000 0.001068800 0.001049400 0.001035600 0.001021200 0.001000000 0.000968640 0.000929920 0.000886880 0.000842560 0.000800000 0.000760960 0.000723680 0.000685920 0.000645440 0.000600000 0.000547867 0.000491600 0.000435400 0.000383467 0.000340000 0.000307253 0.000283160 0.000265440 0.000251813 0.000240000 0.000229547 0.000220640 0.000211960 0.000202187 0.000190000 0.000174213 0.000155640 0.000135960 0.000116853 0.000100000 0.000086133 0.000074600 0.000065000 0.000056933 0.000050000 0.000044160 0.000039480 0.000035720 0.000032640 0.000030000 0.000027653 0.000025560 0.000023640 0.000021813 0.000020000 0.000018133 0.000016200 0.000014200 0.000012133 0.000010000 0.000007733 0.000005400 0.000003200 0.000001333 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000]];

        CIE_1964_XYZ10_CMF_1nm = [[360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 718 719 720 721 722 723 724 725 726 727 728 729 730 731 732 733 734 735 736 737 738 739 740 741 742 743 744 745 746 747 748 749 750 751 752 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767 768 769 770 771 772 773 774 775 776 777 778 779 780 781 782 783 784 785 786 787 788 789 790 791 792 793 794 795 796 797 798 799 800 801 802 803 804 805 806 807 808 809 810 811 812 813 814 815 816 817 818 819 820 821 822 823 824 825 826 827 828 829 830];...
                                  [1.222E-07 1.85138E-07 2.7883E-07 4.1747E-07 6.2133E-07 9.1927E-07 1.35198E-06 1.97654E-06 2.8725E-06 4.1495E-06 5.9586E-06 8.5056E-06 1.20686E-05 1.70226E-05 0.000023868 0.000033266 0.000046087 0.000063472 0.000086892 0.000118246 0.000159952 0.00021508 0.00028749 0.00038199 0.00050455 0.00066244 0.0008645 0.0011215 0.00144616 0.00185359 0.0023616 0.0029906 0.0037645 0.0047102 0.0058581 0.0072423 0.0088996 0.0108709 0.0131989 0.0159292 0.0191097 0.022788 0.027011 0.031829 0.037278 0.0434 0.050223 0.057764 0.066038 0.075033 0.084736 0.095041 0.105836 0.117066 0.128682 0.140638 0.152893 0.165416 0.178191 0.191214 0.204492 0.21765 0.230267 0.242311 0.253793 0.264737 0.275195 0.285301 0.295143 0.304869 0.314679 0.324355 0.33357 0.342243 0.350312 0.357719 0.364482 0.370493 0.375727 0.380158 0.383734 0.386327 0.387858 0.388396 0.387978 0.386726 0.384696 0.382006 0.378709 0.374915 0.370702 0.366089 0.361045 0.355518 0.349486 0.342957 0.335893 0.328284 0.32015 0.311475 0.302273 0.292858 0.283502 0.274044 0.264263 0.254085 0.243392 0.232187 0.220488 0.208198 0.195618 0.183034 0.170222 0.157348 0.14465 0.132349 0.120584 0.109456 0.099042 0.089388 0.080507 0.072034 0.06371 0.055694 0.048117 0.041072 0.034642 0.028896 0.023876 0.019628 0.016172 0.0133 0.010759 0.008542 0.006661 0.005132 0.003982 0.003239 0.002934 0.003114 0.003816 0.005095 0.006936 0.009299 0.012147 0.015444 0.019156 0.02325 0.02769 0.032444 0.037465 0.042956 0.049114 0.05592 0.063349 0.071358 0.079901 0.088909 0.098293 0.107949 0.117749 0.127839 0.13845 0.149516 0.161041 0.172953 0.185209 0.197755 0.210538 0.22346 0.236491 0.249633 0.262972 0.276515 0.290269 0.304213 0.318361 0.332705 0.347232 0.361926 0.376772 0.391683 0.406594 0.421539 0.436517 0.451584 0.466782 0.482147 0.497738 0.513606 0.529826 0.54644 0.563426 0.580726 0.59829 0.616053 0.633948 0.651901 0.669824 0.687632 0.705224 0.722773 0.740483 0.758273 0.776083 0.793832 0.811436 0.828822 0.845879 0.862525 0.878655 0.894208 0.909206 0.923672 0.937638 0.951162 0.964283 0.977068 0.98959 1.00191 1.01416 1.0265 1.0388 1.051 1.0629 1.0743 1.0852 1.0952 1.1042 1.112 1.11852 1.1238 1.128 1.1311 1.1332 1.1343 1.1343 1.1333 1.1312 1.1281 1.12399 1.1189 1.1129 1.1059 1.098 1.0891 1.0792 1.0684 1.0567 1.044 1.03048 1.016 1.0008 0.98479 0.96808 0.95074 0.9328 0.91434 0.89539 0.87603 0.856297 0.83635 0.81629 0.79605 0.77561 0.75493 0.73399 0.71278 0.69129 0.66952 0.647467 0.62511 0.60252 0.57989 0.55737 0.53511 0.51324 0.49186 0.47108 0.45096 0.431567 0.41287 0.39475 0.37721 0.36019 0.34369 0.32769 0.31217 0.29711 0.2825 0.268329 0.25459 0.2413 0.22848 0.21614 0.2043 0.19295 0.18211 0.17177 0.16192 0.152568 0.14367 0.1352 0.12713 0.11948 0.11221 0.10531 0.098786 0.09261 0.086773 0.0812606 0.076048 0.071114 0.066454 0.062062 0.05793 0.05405 0.050412 0.047006 0.043823 0.0408508 0.038072 0.035468 0.033031 0.030753 0.028623 0.026635 0.024781 0.023052 0.021441 0.0199413 0.018544 0.017241 0.016027 0.014896 0.013842 0.012862 0.011949 0.0111 0.010311 0.00957688 0.008894 0.0082581 0.0076664 0.0071163 0.0066052 0.0061306 0.0056903 0.0052819 0.0049033 0.00455263 0.0042275 0.0039258 0.0036457 0.0033859 0.0031447 0.0029208 0.002713 0.0025202 0.0023411 0.00217496 0.0020206 0.0018773 0.0017441 0.0016205 0.0015057 0.0013992 0.0013004 0.0012087 0.0011236 0.00104476 0.00097156 0.0009036 0.00084048 0.00078187 0.00072745 0.0006769 0.00062996 0.00058637 0.00054587 0.000508258 0.0004733 0.0004408 0.00041058 0.00038249 0.00035638 0.00033211 0.00030955 0.00028858 0.00026909 0.000250969 0.00023413 0.00021847 0.00020391 0.00019035 0.00017773 0.00016597 0.00015502 0.0001448 0.00013528 0.00012639 0.0001181 0.00011037 0.00010315 0.000096427 0.000090151 0.000084294 0.00007883 0.000073729 0.000068969 6.45258E-05 0.000060376 0.0000565 0.00005288 0.000049498 0.000046339 0.000043389 0.000040634 0.00003806 0.000035657 3.34117E-05 0.000031315 0.000029355 0.000027524 0.000025811 0.000024209 0.000022711 0.000021308 0.000019994 0.000018764 1.76115E-05 0.000016532 0.000015521 0.000014574 0.000013686 0.000012855 0.000012075 0.000011345 0.000010659 0.000010017 9.41363E-06 8.8479E-06 8.3171E-06 0.000007819 7.3516E-06 0.000006913 6.5015E-06 6.1153E-06 5.7529E-06 5.4127E-06 5.09347E-06 4.7938E-06 4.5125E-06 4.2483E-06 4.0002E-06 3.7671E-06 0.000003548 3.3421E-06 3.1485E-06 2.9665E-06 2.79531E-06 2.6345E-06 2.4834E-06 2.3414E-06 2.2078E-06 0.000002082 1.9636E-06 1.8519E-06 1.7465E-06 1.6471E-06 1.55314E-06];...
                                  [1.3398E-08 2.0294E-08 3.056E-08 4.574E-08 6.805E-08 1.0065E-07 1.4798E-07 2.1627E-07 3.142E-07 4.537E-07 6.511E-07 9.288E-07 1.3175E-06 1.8572E-06 0.000002602 0.000003625 0.000005019 0.000006907 0.000009449 0.000012848 0.000017364 0.000023327 0.00003115 0.00004135 0.00005456 0.00007156 0.0000933 0.00012087 0.00015564 0.0001992 0.0002534 0.0003202 0.0004024 0.0005023 0.0006232 0.0007685 0.0009417 0.0011478 0.0013903 0.001674 0.0020044 0.002386 0.002822 0.003319 0.00388 0.004509 0.005209 0.005985 0.006833 0.007757 0.008756 0.009816 0.010918 0.012058 0.013237 0.014456 0.015717 0.017025 0.018399 0.019848 0.021391 0.022992 0.024598 0.026213 0.027841 0.029497 0.031195 0.032927 0.034738 0.036654 0.038676 0.040792 0.042946 0.045114 0.047333 0.049602 0.051934 0.054337 0.056822 0.059399 0.062077 0.064737 0.067285 0.069764 0.072218 0.074704 0.077272 0.079979 0.082874 0.086 0.089456 0.092947 0.096275 0.099535 0.102829 0.106256 0.109901 0.113835 0.118167 0.122932 0.128201 0.133457 0.138323 0.143042 0.147787 0.152761 0.158102 0.163941 0.170362 0.177425 0.18519 0.193025 0.200313 0.207156 0.213644 0.21994 0.22617 0.232467 0.239025 0.245997 0.253589 0.261876 0.270643 0.279645 0.288694 0.297665 0.306469 0.315035 0.323335 0.331366 0.339133 0.34786 0.358326 0.370001 0.382464 0.395379 0.408482 0.421588 0.434619 0.447601 0.460777 0.47434 0.4882 0.50234 0.51674 0.53136 0.54619 0.56118 0.57629 0.5915 0.606741 0.62215 0.63783 0.65371 0.66968 0.68566 0.70155 0.71723 0.73257 0.74746 0.761757 0.77534 0.78822 0.80046 0.81214 0.82333 0.83412 0.8446 0.85487 0.86504 0.875211 0.88537 0.89537 0.90515 0.91465 0.92381 0.93255 0.94081 0.94852 0.9556 0.961988 0.96754 0.97223 0.97617 0.97946 0.9822 0.98452 0.98652 0.98832 0.99002 0.991761 0.99353 0.99523 0.99677 0.99809 0.99911 0.99977 1 0.99971 0.99885 0.99734 0.99526 0.99274 0.98975 0.9863 0.98238 0.97798 0.97311 0.96774 0.96189 0.955552 0.948601 0.940981 0.932798 0.924158 0.915175 0.905954 0.896608 0.887249 0.877986 0.868934 0.860164 0.851519 0.842963 0.834393 0.825623 0.816764 0.807544 0.797947 0.787893 0.777405 0.76649 0.755309 0.743845 0.73219 0.720353 0.708281 0.696055 0.683621 0.671048 0.658341 0.645545 0.632718 0.619815 0.606887 0.593878 0.580781 0.567653 0.55449 0.541228 0.527963 0.514634 0.501363 0.488124 0.474935 0.461834 0.448823 0.435917 0.423153 0.410526 0.398057 0.385835 0.373951 0.362311 0.350863 0.339554 0.328309 0.317118 0.305936 0.294737 0.283493 0.272222 0.26099 0.249877 0.238946 0.228254 0.217853 0.20778 0.198072 0.188748 0.179828 0.171285 0.163059 0.155151 0.147535 0.140211 0.13317 0.1264 0.119892 0.11364 0.107633 0.10187 0.096347 0.091063 0.08601 0.081187 0.076583 0.072198 0.068024 0.064052 0.060281 0.056697 0.053292 0.050059 0.046998 0.044096 0.041345 0.0387507 0.0362978 0.0339832 0.0318004 0.0297395 0.0277918 0.0259551 0.0242263 0.0226017 0.0210779 0.0196505 0.0183153 0.0170686 0.0159051 0.0148183 0.0138008 0.0128495 0.0119607 0.0111303 0.0103555 0.0096332 0.0089599 0.0083324 0.0077488 0.0072046 0.0066975 0.0062251 0.005785 0.0053751 0.0049941 0.0046392 0.0043093 0.0040028 0.00371774 0.00345262 0.00320583 0.00297623 0.00276281 0.00256456 0.00238048 0.00220971 0.00205132 0.00190449 0.00176847 0.00164236 0.00152535 0.00141672 0.00131595 0.00122239 0.00113555 0.00105494 0.00098014 0.00091066 0.00084619 0.00078629 0.00073068 0.00067899 0.00063101 0.00058644 0.00054511 0.00050672 0.00047111 0.00043805 0.00040741 0.000378962 0.000352543 0.000328001 0.000305208 0.000284041 0.000264375 0.000246109 0.000229143 0.000213376 0.00019873 0.000185115 0.000172454 0.000160678 0.00014973 0.00013955 0.000130086 0.00012129 0.000113106 0.000105501 0.000098428 0.000091853 0.000085738 0.000080048 0.000074751 0.000069819 0.000065222 0.000060939 0.000056942 0.000053217 0.000049737 0.000046491 0.000043464 0.000040635 0.000038 3.55405E-05 3.32448E-05 3.11006E-05 0.000029099 2.72307E-05 0.000025486 2.38561E-05 2.23332E-05 2.09104E-05 1.95808E-05 1.83384E-05 1.71777E-05 1.60934E-05 0.00001508 1.41336E-05 0.000013249 1.24226E-05 1.16499E-05 1.09277E-05 1.02519E-05 9.6196E-06 9.0281E-06 0.000008474 7.9548E-06 7.4686E-06 7.0128E-06 6.5858E-06 6.1857E-06 5.8107E-06 0.000005459 5.1298E-06 4.8206E-06 4.5312E-06 4.2591E-06 4.0042E-06 3.76473E-06 3.53995E-06 3.32914E-06 3.13115E-06 2.94529E-06 2.77081E-06 2.60705E-06 2.45329E-06 2.30894E-06 2.17338E-06 2.04613E-06 1.92662E-06 1.8144E-06 1.70895E-06 1.60988E-06 1.51677E-06 1.42921E-06 1.34686E-06 1.26945E-06 1.19662E-06 1.12809E-06 1.06368E-06 1.00313E-06 9.4622E-07 8.9263E-07 8.4216E-07 7.9464E-07 7.4978E-07 7.0744E-07 6.6748E-07 6.297E-07];...
                                  [5.35027E-07 8.1072E-07 1.2212E-06 1.8287E-06 2.7222E-06 4.0283E-06 5.9257E-06 8.6651E-06 0.000012596 0.000018201 2.61437E-05 0.00003733 0.000052987 0.000074764 0.00010487 0.00014622 0.00020266 0.00027923 0.00038245 0.00052072 0.000704776 0.00094823 0.0012682 0.0016861 0.0022285 0.0029278 0.0038237 0.0049642 0.0064067 0.0082193 0.0104822 0.013289 0.016747 0.02098 0.026127 0.032344 0.039802 0.048691 0.05921 0.071576 0.0860109 0.10274 0.122 0.14402 0.16899 0.19712 0.22857 0.26347 0.3019 0.34387 0.389366 0.43797 0.48922 0.5429 0.59881 0.65676 0.71658 0.77812 0.84131 0.90611 0.972542 1.0389 1.1031 1.1651 1.2249 1.2825 1.3382 1.3926 1.4461 1.4994 1.55348 1.6072 1.6589 1.7082 1.7548 1.7985 1.8392 1.8766 1.9105 1.9408 1.96728 1.9891 2.0057 2.0174 2.0244 2.0273 2.0264 2.0223 2.0153 2.006 1.9948 1.9814 1.9653 1.9464 1.9248 1.9007 1.8741 1.8451 1.8139 1.7806 1.74537 1.7091 1.6723 1.6347 1.5956 1.5549 1.5122 1.4673 1.4199 1.37 1.31756 1.2624 1.205 1.1466 1.088 1.0302 0.97383 0.91943 0.86746 0.81828 0.772125 0.72829 0.68604 0.64553 0.60685 0.57006 0.53522 0.50234 0.4714 0.44239 0.415254 0.390024 0.366399 0.344015 0.322689 0.302356 0.283036 0.264816 0.247848 0.232318 0.218502 0.205851 0.193596 0.181736 0.170281 0.159249 0.148673 0.138609 0.129096 0.120215 0.112044 0.10471 0.098196 0.092361 0.087088 0.082248 0.077744 0.073456 0.069268 0.06506 0.060709 0.056457 0.052609 0.049122 0.045954 0.04305 0.040368 0.037839 0.035384 0.032949 0.030451 0.028029 0.025862 0.02392 0.022174 0.020584 0.019127 0.01774 0.016403 0.015064 0.013676 0.012308 0.011056 0.009915 0.008872 0.007918 0.00703 0.006223 0.005453 0.004714 0.003988 0.003289 0.002646 0.002063 0.001533 0.001091 0.000711 0.000407 0.000184 0.000047 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]];

        % Standard CIE conversion matrices to pass from XYZ to RGB and
        % viceversa.
        CIE_XYZ2RGB_MATRIX = [[0.4185 -0.1587 -0.0828]; [-0.0912 0.2524 0.0157]; [0.0009 0.0025 0.1786]];
        CIE_RGB2XYZ_MATRIX = [[2.7689 1.7517 1.1302]; [1.0000 4.5907 0.0601]; [0.0000 0.0565 5.5943]];
        
        % Chromaticity coordinates of the Monochromatic primaries: 
        % Red (700.0 nm), Green (546.1 nm) and Blue (435.8 nm) 
        % under the reference Equi-energy Illuminant E (same SPD 
        % for all wavelengths).
        CIE_RED_xy = [0.7347 0.2653];
        CIE_GREEN_xy = [0.2738 0.7174];
        CIE_BLUE_xy = [0.1666 0.0089];
        
        % RGB tristimulus values of the Monochromatic primaries and white: 
        % Red (700.0 nm), Green (546.1 nm) and Blue (435.8 nm) 
        % under the reference Equi-energy Illuminant E (same SPD 
        % for all wavelengths).
        CIE_RED_RGB_E = [1 0 0];
        CIE_GREEN_RGB_E = [0 1 0];
        CIE_BLUE_RGB_E = [0 0 1];
        
        CIE_WHITE_RGB_E = [1 1 1];
        
        CIE_RED_WL = 700.0;
        CIE_GREEN_WL = 546.1;
        CIE_BLUE_WL = 435.8;
        
        % White point coordinates for different standard illuminants for
        % standard observers at 2º and 10º.
        CIE_A_xy2 = [0.44757 0.40745];
        CIE_A_xy10 = [0.45117 0.40594];
        CIE_B_xy2 = [0.34842 0.35161];
        CIE_B_xy10 = [0.3498 0.3527];
        CIE_C_xy2 = [0.31006 0.31616];
        CIE_C_xy10 = [0.31039 0.31905];
        CIE_D50_xy2 = [0.34567 0.3585];
        CIE_D50_xy10 = [0.34773 0.35952];
        CIE_D55_xy2 = [0.33242 0.34743];
        CIE_D55_xy10 = [0.33411 0.34877];
        CIE_D65_xy2 = [0.31271 0.32902];
        CIE_D65_xy10 = [0.31382 0.331];
        CIE_D75_xy2 = [0.29902 0.31485];
        CIE_D75_xy10 = [0.29968 0.3174];
        CIE_E_xy2 = [0.33333 0.33333];
        CIE_E_xy10 = [0.33333 0.33333];
        CIE_F7_xy2 = [0.31292 0.32933];
        CIE_F7_xy10 = [0.31569 0.3296];
        
        ILLUM_CIE_A = 1;
        ILLUM_CIE_B = 2;
        ILLUM_CIE_C = 3;
        ILLUM_CIE_D50 = 4;
        ILLUM_CIE_D55 = 5;
        ILLUM_CIE_D65 = 6;
        ILLUM_CIE_D75 = 7;
        ILLUM_CIE_E = 8;
        ILLUM_CIE_F7 = 9;
        ILLUM_CUSTOM = 10;
        
        PLANCKS_CONSTANT = 6.626*(10^-34); % Planck's constant (J·s) 
        SPEED_LIGHT = 3.0*(10^8); % Speed of light (m/s)
        BOLTZMANNS_CONSTANT = 1.381*(10^-23) % Boltzmann's constant (J/K)
        
        % Standard Colorimetric Observers
        STD_OBS_CIE_1931_2 = 2
        STD_OBS_CIE_1964_10 = 10
        
    end
    methods (Static)
        %% loadCMF -- Reads the Color Matching functions into a variable.
        function CMF = loadCMF(deg)
            if nargin < 1, deg = 2; end
            
            if (deg == 10)
                CMF = ColorUtils.CIE_1964_XYZ10_CMF_1nm';
            else
                CMF = ColorUtils.CIE_1931_XYZ_CMF_1nm';
            end
        end 
        
        function cs_name = getColorSpaceName(colorSpace)
            cs_name(1) = ColorUtils.spacenames_long(colorSpace);
            cs_name(2) = ColorUtils.spacenames_short(colorSpace);
        end
        
%% difference_CIEDE2000 -- CIEDE2000 color distance
        function delta_E00 = difference_CIEDE2000 (LAB1, LAB2) 
          
            kL=2; % kL=1 for Graphic Arts applications and kL=2 for textiles applications.
            kC=1;
            kH=1;
            
            delta_L = LAB2(1)-LAB1(1);
            L = (LAB1(1)+LAB2(1))/2;
            
            C1 = sqrt(LAB1(2)^2 + LAB1(3)^2);
            C2 = sqrt(LAB2(2)^2 + LAB2(3)^2);            
            C = (C1+C2)/2;
            delta_C = C2 - C1;
            
            a1 = LAB1(2) + (LAB1(2)/2) * (1 - sqrt(C^7/(C^7+25^7)));
            a2 = LAB2(2) + (LAB2(2)/2) * (1 - sqrt(C^7/(C^7+25^7)));
            
            h1 = mod(atan2(LAB1(3),a1), 2*pi);
            h2 = mod(atan2(LAB2(3),a2), 2*pi);
            
            if (abs(h1 - h2) <= pi) 
                delta_h = h2 - h1;
            elseif (h2 <= h1)
                delta_h = h2 - h1 + (2*pi);
            else
                delta_h = h2 - h1 - (2*pi);
            end
            
            delta_H = 2 * sqrt(C1*C2) * sin(delta_h/2);
            
            if (abs(h1 - h2) > pi)
                H = (h1 + h2 + 2*pi)/2;
            else 
                H = (h1 + h2)/2;
            end
            
            T = 1 - 0.17*cos(H-(pi/6)) + 0.24*cos(2*H) + 0.32*cos((3*H)+(pi/30)) - 0.20*cos((4*H)-(21*pi/60));
            
            SL = 1 + ((0.015*(L-50)^2)/sqrt(20+(L-50)^2));
            SC = 1 + (0.045*C);
            SH = 1 + (0.015*C*T);
            
            RT = -2 * sqrt(C^7/(C^7+25^7)) * sin ((pi/3) * exp(-((H-(pi*(55/36)))/(pi*(5/36)))^2));
            
            delta_E00 = sqrt((delta_L/(kL*SL))^2 + (delta_C/(kC*SC))^2 + (delta_H/(kH*SH))^2 + (RT*(delta_C/(kC*SC))*(delta_H/(kH*SH))));
                
        end
        
        %% Euclidean_distance -- Euclidean distance between two stimuli.
        function delta = Euclidean_distance (ABC1, ABC2)            
            delta = sqrt((ABC2(1)-ABC1(1))^2 + (ABC2(2)-ABC1(2))^2 + (ABC2(3)-ABC1(3))^2);
        end
        
        %% difference_CIE94 -- CIE94 color distance
        function delta_E94 = difference_CIE94 (LAB1, LAB2)
            % Calculate the color differences, using the CIE94 method.  
            
            kL=2; % kL=1 for Graphic Arts applications and kL=2 for textiles applications.
            kC=1;
            kH=1;
            
            K1=0.048; % K1=0.045 for Graphic Arts applications and K1=0.048 for textiles applications.
            K2=0.014; % K2=0.015 for Graphic Arts applications and K2=0.014 for textiles applications.
            
            delta_L = LAB1(1) - LAB2(1);
            C1 = sqrt(LAB1(2)^2 + LAB1(3)^2);
            C2 = sqrt(LAB2(2)^2 + LAB2(3)^2);            
            delta_Cab = C1 - C2;
            
            delta_a = LAB1(2) - LAB2(2);
            delta_b = LAB1(3) - LAB2(3);            
           
            delta_Hab = sqrt(delta_a^2 + delta_b^2 - delta_Cab^2);
            
            SL = 1;
            SC = 1 + K1*C1;
            SH = 1 + K2*C1;
            
            delta_E94 = sqrt((delta_L/(kL*SL))^2 + (delta_Cab/(kC*SC))^2 + (delta_Hab/(kH*SH))^2);
        end
        
        %% spect2XYZ -- Computes the XYZ tristimulus from a given SPD.
        function XYZ = spect2XYZ(P, CMF, b_start, b_end, lambda, I, norm)
        %
        % Converts a given spectral power distribution (SPD) into the XYZ color space.
        %
        % INPUT:
        %     P --> A Nx2 matrix containing the SPD of the given stimulus. The first 
        %           column contains the sampled wavelength and the second column 
        %           contains the corresponding power measured at that wavelength. 
        %
        %   CMF --> A Nx4 matrix containing the Color Matching Functions (CMFs) for
        %           the standard colorimetric observer. The first column contains 
        %           the sampled wavelength and the second, third and fourth columns 
        %           contain, respectively, the averaged color matching weights for
        %           x, y and z. 
        %  norm --> Normalization factor that represents the luminance of
        %           the reference white.
        %
        % b_start, b_end --> The initial and final values of the sampled wavelength band. 
        %                    If no values are given, the first and last sampled
        %                    wavelengths in P are taken by default.
        %   
        %   lambda --> The step size between sampled wavelengths. By default, 5 is used.
        %
        %        I --> A Nx2 matrix containing the SPD of the illuminant.
        %              The first column contains the sampled wavelength 
        %              and the second column contains the corresponding
        %              power measured at that wavelength. If no illuminant
        %              is given, an array of ones is used, so that all
        %              wavelengths are included in the calculations.
        %
        % OUTPUT: 
        %   XYZ --> A 1x3 row vector containing the corresponding tristimulus values 
        %           in the XYZ color space.
        %
            if nargin < 7
                norm = 0;                
            end
            
            if nargin < 6
                I = ones(size(P));
                I(:,1) = P(:,1);
            end
            
            if nargin < 3
                b_start = P(1,1); 
                b_end = P(size(P,1));
                lambda = 5;
            end

            P = ColorUtils.resample_array (P, b_start:lambda:b_end);
            I = ColorUtils.resample_array (I, b_start:lambda:b_end);
            CMF = ColorUtils.resample_array (CMF, b_start:lambda:b_end);            

%             if (norm > 0)
%                 if nargin < 6
%                     k = norm/(sum( CMF(:,3) .* P(:,2) )); %* lambda;
%                 else
%                     k = norm/(sum( CMF(:,3) .* I(:,2) )); %* lambda;
%                 end
%             else
%                 k = 1;
%             end
            
            % We are working with colors and therefore visible light, which
            % means that are working with photometric units, so the constant
            % should always be the photometric constant 683 lumen/Watt.
            k = 683;            
            
            X = sum( P(:,2) .* I(:,2) .* CMF(:,2) ) * k * lambda; %* lambda;
            Y = sum( P(:,2) .* I(:,2) .* CMF(:,3) ) * k * lambda; %* lambda;
            Z = sum( P(:,2) .* I(:,2) .* CMF(:,4) ) * k * lambda; %* lambda;
            
            XYZ = [X Y Z];
        end
        
        %% XYZ2RGB -- XYZ to sRGB conversion
        function RGB = XYZ2RGB (XYZ, M)
        %
        % Converts a given set of XYZ Tristimulus Values into the RGB color space.
        %
        % INPUT:
        %   XYZ --> A 1x3 row vector containing the three XYZ tristimulus values of the color.
        %     M --> The conversion matrix for the color space's primaries, such that 
        %           [RGB] = M * [XYZ]
        %           If no matrix is supplied, a default one (defined for a standard 
        %           illuminant) is used instead.
        %
        % OUTPUT: 
        %   RGB --> A 1x3 row vector containing the corresponding tristimulus values 
        %           in the RGB color space, in the range [0.0, 1.0].
        %
            if nargin < 2
                M = ColorUtils.CIE_XYZ2RGB_MATRIX;
            end
            
            % Normalize M to 1
            %M = M ./ max(max(M));
            
            XYZ2RGB = M;

            temp = XYZ2RGB * XYZ';
            RGB(1) = temp(1);
            RGB(2) = temp(2);
            RGB(3) = temp(3);
        end
        
        %% RGB2XYZ -- RGB to XYZ conversion
        function XYZ = RGB2XYZ (RGB,M)
        %
        % Converts a given set of RGB Tristimulus Values into the XYZ color space.
        %
        % INPUT:
        %   RGB --> A 1x3 row vector containing the three RGB tristimulus values of the color.
        %     M --> The conversion matrix for the color space's primaries, such that 
        %           [XYZ] = M * [RGB]
        %           If no matrix is supplied, a default one (defined for a standard 
        %           illuminant) is used instead.
        %
        % OUTPUT: 
        %   XYZ --> A 1x3 row vector containing the corresponding tristimulus values 
        %           in the XYZ color space.
        %
            if nargin < 2
                M = ColorUtils.CIE_RGB2XYZ_MATRIX;
            end
            
            % Normalize M to 1
            %M = M ./ max(max(M));
            
            RGB2XYZ = M;

            temp = RGB2XYZ * [RGB(1); RGB(2); RGB(3)];
            XYZ(1) = temp(1);
            XYZ(2) = temp(2);
            XYZ(3) = temp(3);
        end
        
        %% RGB2sRGB -- RGB to sRGB conversion
        function sRGB = RGB2sRGB(RGB) 
        %
        % Performs an sRGB companding to pass from a linear set of RGB
        % tristimulus values to a set of companded sRGB tristimulus.
        % 
        % INPUT:
        %    RGB --> the RGB tristimulus values in the range [0.0, 1.0].
        %            Note that if the input values are not expressed in the
        %            right range the results might be incorrect.
        %
        % OUTPUT:
        %   sRGB --> The companded set of sRGB tristimulus, also in the
        %            range [0.0, 1.0].
        %
            sRGB = RGB;

            for i=1:3
                if (RGB(i) <= 0.0031308) 
                    sRGB(i) = RGB(i)*12.92;
                else
                    sRGB(i) = ((1 + 0.055) * (RGB(i)^(1/2.4)))-0.055;                    
                end
%                 sRGB(i) = sRGB(i) * 255;
%                 sRGB(i) = min(255.0,max(0.0,sRGB(i)));
%                 sRGB(i) = int(sRGB(i) + 0.5);
            end
            
            sRGB = sRGB.^(1/2.2);
        end
        
        %% sRGB2RGB -- sRGB to RGB conversion
        function RGB = sRGB2RGB(sRGB)
        %        
        % Performs an sRGB decompanding to pass from an unlinear set of sRGB
        % tristimulus values to a set of RGB tristimulus.
        % 
        % INPUT:
        %   sRGB --> the sRGB tristimulues values in the range [0.0, 1.0].
        %            Note that if the input values are not expressed in the
        %            right range the results might be incorrect.
        %
        % OUTPUT:
        %    RGB --> The "linearized" set of RGB tristimulus, also in the
        %            range [0.0, 1.0].
        %
            RGB = sRGB;
            
            RGB = RGB.^(2.2);

            for i=1:3
                if (sRGB(i) <= (0.0031308*12.92)) 
                    RGB(i) = sRGB(i)/12.92;
                else
                    RGB(i) = ((sRGB(i)+0.055)/(1+0.055))^2.4;
                end               
%               RGB(i) = RGB(i)/255;
%               RGB(i) = min(255.0,max(0.0,RGB(i)));
%               RGB(i) = int(RGB(i) + 0.5);
            end                        
        end
        
        %% sRGB2XYZ -- sRGB to XYZ conversion
        function XYZ = sRGB2XYZ(sRGB, M)
            % Undo sRGB companding to obtain linear RGB.
            RGB = ColorUtils.sRGB2RGB(sRGB);            
            % RGB to XYZ conversion.
            XYZ = ColorUtils.RGB2XYZ(RGB, M);
        end
        
        %% XYZ2sRGB -- XYZ to sRGB conversion
        function sRGB = XYZ2sRGB(XYZ, M)
            RGB = ColorUtils.XYZ2RGB(XYZ, M);
            sRGB = ColorUtils.RGB2sRGB(RGB);            
        end
        
        %% XYZ2xy -- XYZ to xy conversion
        function xy = XYZ2xy (XYZ)
        %
        % Given a set of XYZ Tristimulus Values, this function returns its
        % xy chromaticity coordinates.
        %
        % INPUT:
        %     XYZ --> The corresponding tristimulus values in the XYZ color space
        %             with values in the range [0.0, 1.0].
        % OUTPUT: 
        %     xyY --> The three xyY tristimulus values of the color. 
        %
                        
            xy = zeros(1,2);

            xy(1) = XYZ(1)/sum(XYZ);
            xy(2) = XYZ(2)/sum(XYZ);
        end 
        
        %% XYZ2xyY -- XYZ to xyY conversion
        function xyY = XYZ2xyY (XYZ)
        %
        % Converts a given set of XYZ Tristimulus Values into the xyY color space.
        %
        % INPUT:
        %     XYZ --> The corresponding tristimulus values in the XYZ color space
        %             with values in the range [0.0, 1.0].
        % OUTPUT: 
        %     xyY --> The three xyY tristimulus values of the color. 
        %
                        
            xyY = zeros(1,3);

            xyY(1) = XYZ(1)/sum(XYZ);
            xyY(2) = XYZ(2)/sum(XYZ);
            xyY(3) = XYZ(2);
        end 
        
        %% xyY2XYZ -- xyY to XYZ conversion
        function XYZ = xyY2XYZ (xyY)
        %
        % Converts a given set of xyY Tristimulus Values into the XYZ color space.
        %
        % INPUT:
        %     xyY --> The three xyY tristimulus values of the color. 
        %
        % OUTPUT: 
        %     XYZ --> The corresponding tristimulus values in the XYZ color space
        %             with values in the range [0.0, 1.0].
        %
            
            y = xyY(2);
            Y = xyY(3);
            x = xyY(1);

            XYZ = zeros(1,3);

            if y ~= 0    
                XYZ(1) = (x*Y)/y;
                XYZ(2) = Y;
                XYZ(3) = ((1-x-y)*Y)/y;
            end
        end
        
        %% XYZ2Lab -- XYZ to L*a*b* conversion
        function Lab = XYZ2Lab(XYZ,XYZr)
        %
        % This function receives as input the tristimulus values X,Y,Z
        % of a color stimulus for a given illuminant, along with the 
        % tristimulus values of a perfect reflecting diffuser under the 
        % same illuminant, and returns the L*,a* and b* chromaticity 
        % coordinates of the stimulus.
        %
        % INPUT:
        %     XYZ --> The XYZ tristimulus values of the color. 
        %    XYZr --> The XYZ tristimulus values of the reference white.
        %
        % OUTPUT: 
        %     Lab --> The corresponding tristimulus values in the Lab color
        %             space.
        %          
                        
            X = XYZ(1); Y = XYZ(2); Z = XYZ(3);
            Xr = XYZr(1); Yr = XYZr(2); Zr = XYZr(3);
            
            e = (24/116)^3;
            k = (841/108)*116;
            
            if (X/Xr > e), fx = (X/Xr)^(1/3);
            else fx = ((k*(X/Xr))+16)/116;
            end

            if (Y/Yr > e), fy = (Y/Yr)^(1/3);
            else fy = ((k*(Y/Yr))+16)/116;
            end

            if (Z/Zr > e), fz = (Z/Zr)^(1/3);
            else fz = ((k*(Z/Zr))+16)/116;
            end

            L = (116*fy)-16;
            a = 500 * (fx-fy);
            b = 200 * (fy-fz);
            Lab = [L a b];
        end
        
        %% Lab2XYZ -- L*a*b* to XYZ conversion
        function XYZ = Lab2XYZ (Lab, XYZr)
        %
        % Converts a given set of Lab Tristimulus Values into the XYZ color 
        % space.
        %
        % INPUT:
        %    Lab --> The Lab tristimulus values of the color.
        %   XYZr --> The XYZ tristimulus values of the reference white.
        %
        % OUTPUT: 
        %    XYZ --> The corresponding tristimulus values in the XYZ color
        %             space.
        %

            L = Lab(1); a = Lab(2); b = Lab(3);
            Xr = XYZr(1); Yr = XYZr(2); Zr = XYZr(3);
            
            e = (24/116)^3;
            k = (841/108)*116;
            
            fy = (L+16)/116;
            fx = (a/500) + fy;
            fz = fy - (b/200);            
            
            if (fx^3 > e), xr = fx^3;
            else xr = ((116*fx)-16)/k;
            end

            if (L > k*e), yr = ((L+16)/116)^3;
            else yr = L/k;
            end

            if (fz^3 > e), zr = fz^3;
            else zr = ((116*fz)-16)/k;
            end

            X = xr*Xr;
            Y = yr*Yr;
            Z = zr*Zr;
            XYZ = [X Y Z];
        end
        
        %% XYZ2Luv -- XYZ to L*u*v* conversion
        function Luv = XYZ2Luv(XYZ,XYZr)
        %
        % This function receives as input the tristimulus values X,Y,Z
        % of a color stimulus for a given illuminant, along with the 
        % tristimulus values of a perfect reflecting diffuser under the 
        % same illuminant, and returns the L*,u* and v* chromaticity 
        % coordinates of the stimulus.
        %
        % INPUT:
        %     XYZ --> The XYZ tristimulus values of the color. 
        %    XYZr --> The XYZ tristimulus values of the reference white.
        %
        % OUTPUT: 
        %     Luv --> The corresponding tristimulus values in the Luv color
        %             space.
        %          
                        
            X = XYZ(1); Y = XYZ(2); Z = XYZ(3);
            Xr = XYZr(1); Yr = XYZr(2); Zr = XYZr(3);
            
            e = (24/116)^3;
            k = (841/108)*116;
            
            yr = Y/Yr;
            
            if (yr > e)
                L = (116*(yr^(1/3)))-16;
            else
                L = k*yr;
            end
            
            u0 = (4*X)/(X+(15*Y)+(3*Z));
            v0 = (9*Y)/(X+(15*Y)+(3*Z));
            
            ur = (4*Xr)/(Xr+(15*Yr)+(3*Zr));
            vr = (9*Yr)/(Xr+(15*Yr)+(3*Zr));
            
            u = 13 * L * (u0-ur);
            v = 13 * L * (v0-vr);
                        
            Luv = [L u v];
        end
                
        %% Luv2XYZ -- L*u*v* to XYZ conversion
        function XYZ = Luv2XYZ (Luv, XYZr)
        %
        % Converts a given set of Luv Tristimulus Values into the XYZ color 
        % space.
        %
        % INPUT:
        %    Luv --> The Luv tristimulus values of the color.
        %   XYZr --> The XYZ tristimulus values of the reference white.
        %
        % OUTPUT: 
        %    XYZ --> The corresponding tristimulus values in the XYZ color
        %             space.
        %

            L = Luv(1); u = Luv(2); v = Luv(3);
            Xr = XYZr(1); Yr = XYZr(2); Zr = XYZr(3);
            
            e = (24/116)^3;
            k = (841/108)*116;
            
            ur = (4*Xr)/(Xr+(15*Yr)+(3*Zr));
            vr = (9*Yr)/(Xr+(15*Yr)+(3*Zr));
                        
            if (L > k*e)                
                Y = ((L+16)/116)^3;
            else
                Y = L/k;
            end
            
            a = (1/3)*(((52*L/(u+(13*L*ur))))-1);
            b = -5*Y;
            c = -1/3;
            d = Y * (((39*L)/(v+(13*L*vr)))-5);
            
            X = (d-b)/(a-c);
            Z = (X*a)+b;

            XYZ = [X Y Z];
        end
                
        %% XYZ2uv -- XYZ to u'v' coordinates conversion
        function uv = XYZ2uv(XYZ)
        %
        % Given a set of XYZ Tristimulus Values, this function returns the
        % corresponding chromaticity coordinates in the (u?, v?) chromaticity 
        % diagram, also known as the CIE 1976 UCS (uniform chromaticity scale) 
        % diagram.
        %
        % INPUT:
        %    XYZ --> The XYZ tristimulus values of the color.
        %
        % OUTPUT: 
        %     uv --> The corresponding chromaticity coordinates in the 
        %            (u?, v?) diagram.
        %

            uv = zeros(1,2);
            uv(1) = (4*XYZ(1))/(XYZ(1)+(15*XYZ(2))+(3*XYZ(3)));
            uv(2) = (9*XYZ(2))/(XYZ(1)+(15*XYZ(2))+(3*XYZ(3)));
        end
        
        %% xy2uv -- xy to u'v' coordinates conversion
        function uv = xy2uv(xy)
        %
        % Given a set of xy chromaticity coordinates, this function returns
        % the corresponding coordinates in the (u?, v?) chromaticity
        % diagram, also known as the CIE 1976 UCS (uniform chromaticity scale) 
        % diagram.
        %
        % INPUT:
        %    xy --> The xy chromaticity coordinates of the color.
        %
        % OUTPUT: 
        %     uv --> The corresponding chromaticity coordinates in the 
        %            (u?, v?) diagram.
        %

            uv = zeros(1,2);
            uv(1) = (4*xy(1))/((-2*xy(1))+(12*xy(2))+3);
            uv(2) = (9*xy(2))/((-2*xy(1))+(12*xy(2))+3);
        end
        
        %% XYZ2LMS -- XYZ to LMS conversion
        function LMS = XYZ2LMS(XYZ, CATM)
        %
        % This function receives as input the tristimulus values X,Y,Z
        % of a color stimulus, and returns the LMS tristimulus values
        % of the color stimulus.
        %
        % INPUT:
        %     XYZ --> The XYZ tristimulus values of the color.
        %    CATM --> Chromatic Adaptation transformation matrix. It can be
        %             one of the following class constants: CAT_BRADFORD, 
        %             CAT_RLAB_E, CAT_VONKRIES, CAT_CAT97s, CAT_CAT02 or
        %             CAT_PIT45. Alternatively, it can be any 3x3 chromatic
        %             adaptation matrix.
        %
        % OUTPUT: 
        %     Lab --> The corresponding tristimulus values in the Lab color
        %             space.
        %          
               
            if (nargin < 2)
                CATM = ColorUtils.CAT_BRADFORD;
            end
        
            LMS = CATM * XYZ';
        end
        
        %% RGB2HSV -- RGB to HSV conversion
        function HSV = RGB2HSV(R,G,B)
        %
        % This function receives as input the tristimulus values R,G,B
        % of a color stimulus, and returns the HSV tristimulus values
        % of the color stimulus.
        %
        % INPUT:
        %     R,G,B --> The RGB tristimulus values of the color. If only
        %     one argument is given, it must be a 3x1 or 1x3 vector
        %     containing the 3 values.
        %
        % OUTPUT: 
        %     HSV --> The corresponding tristimulus values in the HSV color
        %             space.
        %          
        % http://www.cs.rit.edu/~ncs/color/t_convert.html#RGB to HSV & HSV to RGB
        %
               
            if (nargin > 1), RGB = [R G B]; 
            else RGB = R; end
                
            %HSV = [0 0 0];
            
            MIN = min(RGB');
            MAX = max(RGB');
            
            MIN = MIN';
            MAX = MAX';
            delta = MAX - MIN;
            
            HSV(:,3) = MAX;
            
            temp = (MAX ~= 0);
            %if (MAX ~= 0)
                HSV(temp,2) = delta(temp)./MAX(temp);
            %else
                temp = ~temp;
                HSV(temp,2) = 0;
                HSV(temp,1) = -1;
            %end
                
            temp = (RGB(:,1)==MAX);
            %if (RGB(:,1)==MAX)
                HSV(temp,1) = (RGB(temp,2)-RGB(temp,3))./delta(temp);
            %else
                temp2 = (RGB(:,2)==MAX);
                temp3 = ~temp & temp2;
                %if (RGB(:,2)==MAX)
                    HSV(temp3,1) = 2 + (RGB(temp3,3)-RGB(temp3,1))./delta(temp3);
                %else
                temp3 = ~temp & ~temp2;
                    HSV(temp3,1) = 4 + (RGB(temp3,1)-RGB(temp3,2))./delta(temp3);
                %end
            %end
            
            HSV(:,1) = HSV(:,1) .* 60;
            temp = (HSV(:,1) < 0);
            %if (HSV(:,1) < 0)
                HSV(temp,1) = HSV(temp,1) + 360;
            %end
            
        end
        
        %% HSV2RGB -- HSV to RGB conversion
        function RGB = HSV2RGB(HSV)
            
            if (HSV(2) == 0)  
                RGB = [HSV(3) HSV(3) HSV(3)];
            else
                HSV(1) = HSV(1) / 60;
                i = floor(HSV(1));
                f = HSV(1) - i;
                p = HSV(3) * (1 - HSV(2));
                q = HSV(3) * (1 - HSV(2) * f);
                t = HSV(3) * (1 - HSV(2) * (1-f));
                switch i
                    case 0
                        RGB = [HSV(3) t p];
                    case 1
                        RGB = [q HSV(3) p];
                    case 2
                        RGB = [p HSV(3) t];
                    case 3
                        RGB = [p q HSV(3)];
                    case 4
                        RGB = [t p HSV(3)];
                    otherwise
                        RGB = [HSV(3) p q];
                end
            end
        end
        
        %% CAT -- Color Adaptation Transforms
        function XYZd = CAT(XYZs, XYZ_Ws, XYZ_Wd, CATM)
            % Linear transformation of a source color XYZs into a destination 
            % color XYZd by a linear transformation [M] which is dependent 
            % on the source reference white XYZ_Ws and the destination reference 
            % white XYZ_Wd.
            %
            % Different CAT matrices are allowed, but typically only three
            % transforms are used: Von Kries, Bradford, and XYZ Scaling. 
            % Most experts consider the Bradford method to be the best one, 
            % followed by the Von Kries transform; XYZ scaling is
            % considered to be a lower quality method. 
            %
            % See http://www.brucelindbloom.com/Eqn_ChromAdapt.html
            %
            % INPUT:
            %    XYZs --> The XYZ tristimulus values of the color stimulus
            %             under the source (reference) illuminant.
            %  XYZ_Ws --> The XYZ tristimulus values of a perfect diffuser
            %             (reference white) under the source illuminant.
            %  XYZ_Wd --> The XYZ tristimulus values of a perfect diffuser
            %             under the destination (test) illuminant.
            %    CATM --> Chromatic Adaptation transformation matrix. It can be
            %             one of the following class constants: CAT_BRADFORD, 
            %             CAT_RLAB_E, CAT_VONKRIES, CAT_CAT97s, CAT_CAT02 or
            %             CAT_PIT45. Alternatively, it can be any 3x3 chromatic
            %             adaptation matrix.
            %
            %       CAT_BRADFORD: Bradford Transform (Default)
            %       CAT_VONKRIES: Von Kries Transform
            %             
            % OUTPUT: 
            %    XYZd --> The XYZ tristimulus values of the color stimulus
            %             under the destination (test) illuminant.
            %          
                                    
            if (nargin < 4)                
                CATM = ColorUtils.CAT_BRADFORD;
            end
            
            % We use LMS here in a very wide sense to refer to some value 
            % represention in a cone response domain.
            
            LMS_Ws = CATM * XYZ_Ws';
            LMS_Wd = CATM * XYZ_Wd';

            D = [ LMS_Wd(1)/LMS_Ws(1), 0, 0; 0, LMS_Wd(2)/LMS_Ws(2), 0; 0, 0, LMS_Wd(3)/LMS_Ws(3) ];
            
            XYZd = (inv(CATM) * D * CATM) * XYZs';            
        end
        
        %% CAT_Scaling -- Color Adaptation Transform using the XYZ scaling method
        function XYZd = CAT_Scaling(XYZs, XYZ_Ws, XYZ_Wd)
            % Linear transformation of a source color XYZs into a destination 
            % color XYZd by a linear transformation [M] which is dependent 
            % on the source reference white XYZ_Ws and the destination reference 
            % white XYZ_Wd.
            %
            % This implementation uses the XYZ scaling method. It is generally 
            % considered to be an inferior chromatic adaptation algorithm, 
            % which, effectively, consists in transforming the source 
            % XYZ color to Lab using the source reference white (XYZ_Ws) 
            % followed by a conversion back to XYZ using the destination 
            % reference white (XYZ_Wd). This is indeed equivalent to
            % calling method "ChromAdap" with a 3x3 identity matrix, so the
            % two function calls below are equivalent:
            %
            %  > CAT_Scaling (XYZs, XYZ_Ws, XYZ_Wd)
            %  > CAT (XYZs, XYZ_Ws, XYZ_Wd, eye(3,3))
            %
            % See http://www.brucelindbloom.com/Eqn_ChromAdapt.html
            %
            % INPUT:
            %    XYZs --> The XYZ tristimulus values of the color stimulus
            %             under the source (reference) illuminant.
            %  XYZ_Ws --> The XYZ tristimulus values of a perfect diffuser
            %             (reference white) under the source illuminant.
            %  XYZ_Wd --> The XYZ tristimulus values of a perfect diffuser
            %             under the destination (test) illuminant.
            %             
            % OUTPUT: 
            %    XYZd --> The XYZ tristimulus values of the color stimulus
            %             under the destination (test) illuminant.
            %
            
            Lab_Ws = ColorUtils.XYZ2Lab(XYZs, XYZ_Ws);
            XYZd = ColorUtils.Lab2XYZ(Lab_Ws, XYZ_Wd);   
        end
        
        %% resample_array -- Changes the sampling step of an array.
        function [B] = resample_array (A, V)
        % 
        % Takes an Nx2 array of values where the first column represents the sample
        % point and the second column represents the value at that point. It then
        % reduces the sampling interval to match the values in the input V vector.
        %
        % INPUT
        %    A: the Nx2 data array
        %    V: A vector containing the new sample points.
        % OUTPUT
        %    B: the N'x2 resampled data array.
        %
        % EXAMPLE
        %
        %     B = resample_array (A, [380:10:780]);
        % 
        %     where A contains data sampled every 0.47 units, between 200 and 1000.
        %     The result is a new data matrix with data sampled every 10 units,
        %     between 380 and 780.
        %

            [xA, yA] = size(A);

            [xV, yV]=size(V);
            if (xV < yV), V=V'; end
            [xV, yV]=size(V);

            if (V(1) < A(1,1)) || (V(numel(V)) > A(xA,1))
                error('Some values in range vector V are out of the boundaries of array A.');
            end


            numValues = xV;
            B = [V zeros(xV,yV)];

            for i=1:numValues
                currValue = V(i);
                index = ColorUtils.find_closest_index(A(:,1),currValue);
                if currValue == A(index,1)
                    for c=2:yA
                        B(i,c) = A(index,c);
                    end
                else
                    if currValue > A(index,1), index = index+1; end
                    for c=2:yA
                        B(i,c) = A(index,c) - ((A(index,c)-A(index-1,c))*(A(index,1)-currValue))/(A(index,1)-A(index-1,1));
                    end
                end        
            end
        end
        
        %% find_closest_index -- find the closest value in an array.
        function [index, fclosest] = find_closest_index (A,val)
        %
        % Given an input array and a value, this function searches for the
        % closest value in the array and returns the index where the value
        % was found. 
        %
        % This is an auxiliary function that is required by the resample_array
        % method. It was made static in case it might be useful for certain
        % scripts. 
        % 
        % INPUT:
        %   A --> The array to be searched.
        % val --> The value to find in the array.
        %
        % OUTPUT:
        %  index --> The index where the closest value was found in the array.
        %            Note that this function will always return an index,
        %            unless the array is empty.
        %
            [N,bin]=histc(val,A);

            index=bin+1;
            if (index < size(A,1))
                if abs(val - A(bin)) < abs(val - A(bin+1))
                    fclosest = A(bin);
                    index = bin;
                else
                    fclosest = A(index);
                end
            else
                fclosest = A(bin);
                index = bin;
            end
        end 
        
        function M = kelvin2mired(K)
        %
        % Converts a given color temperature (expressed in Kelvin, K) to 
        % reciprocal color temperature, or Micro reciprocal degrees (Mired), 
        % expressed in reciprocal megakelvin (MK-1).
        %
            M = 1000000/K;
        end
        
        function U = blackBodySPD(lambda, temp)
            h = ColorUtils.PLANCKS_CONSTANT;
            k = ColorUtils.BOLTZMANNS_CONSTANT;
            c = ColorUtils.SPEED_LIGHT;
            
            U = (8 * pi * h * c * (lambda^-5)) / (exp((h * c)/(lambda * k * temp)) - 1);
        end
        
        function locus = PlanckianLocus (colorSpace)
            min_temp = 1667;
            max_temp = 25000;
            
            locus = zeros(max_temp - min_temp,2);
            
            for temp = min_temp : max_temp
                ccord = ColorUtils.PlanckianLocusPoint(temp);
                switch(colorSpace)                    
                    case ColorUtils.COLOR_SPACE_LUV
                        ccord = ColorUtils.xy2uv(ccord);
                end
                locus(temp-min_temp+1,1) = ccord(1);
                locus(temp-min_temp+1,2) = ccord(2);
            end
        end
        
        function xy = PlanckianLocusPoint(temp)
        % 
        % Cubic spline approximation[1] of the Planckian locus as a function
        % of the blackbody's reciprocal temperature. 
        %
        % [1] US patent 7024034, Kim et al., "Color Temperature Conversion 
        %     System and Method Using the Same", issued 2006-04-04.
        %        
            if (temp >= 1667 &&  temp <= 4000)
                xy(1) = (-0.2661239 * ((10^9)/(temp^3))) - (0.2343580 * ((10^6)/(temp^2))) + (0.8776956 * ((10^3)/temp)) + 0.179910;
            else
                if (temp > 4000 &&  temp <= 25000)
                    xy(1) = (-3.0258469 * ((10^9)/(temp^3))) + (2.1070379 * ((10^6)/(temp^2))) + (0.2226347 * ((10^3)/temp)) + 0.240390;
                end
            end
            
            if (temp >= 1667 &&  temp <= 2222)
                xy(2) = (-1.1063814 * xy(1)^3) - (1.34811020 * xy(1)^2) + (2.18555832 * xy(1)) - 0.20219683;
            else
                if (temp >= 2222 &&  temp <= 4000)
                    xy(2) = (-0.9549476 * xy(1)^3) - (1.37418593 * xy(1)^2) + (2.09137015 * xy(1)) - 0.16748867;
                else
                    if (temp > 4000 &&  temp <= 25000)
                        xy(2) = (+3.0817580 * xy(1)^3) - (5.87338670 * xy(1)^2) + (3.75112997 * xy(1)) - 0.37001483;
                    end
                end
            end
        end
    end
end